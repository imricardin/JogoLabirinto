import time
import os

def limpar_tela():
    os.system('cls' if os.name == 'nt' else 'clear')

def exibir_labirinto(jogador_pos, labirinto):
    labirinto_temp = [linha[:] for linha in labirinto]
    x, y = jogador_pos
    labirinto_temp[x][y] = 'â™™'
    print("ðŸŒŸ LABIRINTO ðŸŒŸ")
    for linha in labirinto_temp:
        print(" ".join(linha))

def mover_jogador(pos, movimento, labirinto, tem_chave):
    x, y = pos
    novo_x, novo_y = x, y

    if movimento == 'w':
        novo_x -= 1
    elif movimento == 's':
        novo_x += 1
    elif movimento == 'a':
        novo_y -= 1
    elif movimento == 'd':
        novo_y += 1
    else:
        print("Movimento invÃ¡lido. Use apenas W, A, S ou D.")
        time.sleep(1)
        return pos, tem_chave

    if 0 <= novo_x < len(labirinto) and 0 <= novo_y < len(labirinto[0]):
        destino = labirinto[novo_x][novo_y]
        if destino == '#':
            print("Parede! VocÃª nÃ£o pode passar por aqui.")
            time.sleep(1)
        elif destino == 'â™–':
            print("VocÃª encontrou a chave no baÃº! Agora pode abrir a porta.")
            tem_chave = True
            labirinto[novo_x][novo_y] = '.'
            return (novo_x, novo_y), tem_chave
        elif destino == 'â–£':
            if tem_chave:
                print("VocÃª usou a chave e abriu a porta!")
                labirinto[novo_x][novo_y] = '.'
                return (novo_x, novo_y), tem_chave
            else:
                print("A porta estÃ¡ trancada. VocÃª precisa da chave.")
                time.sleep(1)
        else:
            return (novo_x, novo_y), tem_chave
    else:
        print("Movimento fora dos limites.")
        time.sleep(1)

    return pos, tem_chave

def jogar(nome):
    labirinto = [
        ['.', '.', '.', '#', '.'],
        ['.', '#', '.', '#', '.'],
        ['.', '.', '.', '#', '.'],
        ['#', '#', '.', '.', 'â–£'],
        ['â™–', '.', '.', '#', 'â™”']
    ]
    
    jogador_pos = (0, 0)
    objetivo = (4, 4)
    movimentos = 0
    max_movimentos = 30
    tem_chave = False

    inicio = time.time()

    while True:
        limpar_tela()
        exibir_labirinto(jogador_pos, labirinto)
        print(f"Movimentos restantes: {max_movimentos - movimentos}")
        movimento = input("Digite o movimento (W, A, S ou D): ").lower()

        if movimento not in ['w', 'a', 's', 'd']:
            print("Comando invÃ¡lido. Use apenas W, A, S ou D.")
            time.sleep(1)
            continue

        jogador_pos, tem_chave = mover_jogador(jogador_pos, movimento, labirinto, tem_chave)
        movimentos += 1

        if jogador_pos == objetivo:
            if labirinto[3][4] != '.':
                print("VocÃª precisa abrir a porta antes de vencer!")
                time.sleep(2)
                continue
            tempo_total = round(time.time() - inicio, 2)
            limpar_tela()
            exibir_labirinto(jogador_pos, labirinto)
            print(f"ParabÃ©ns, {nome}! VocÃª venceu!")
            print(f"Tempo total: {tempo_total} segundos | Movimentos: {movimentos}")
            break

        if movimentos >= max_movimentos:
            print("VocÃª excedeu o nÃºmero mÃ¡ximo de movimentos. Tente novamente!")
            tentar = input("Deseja tentar novamente? [S/N]: ").lower()
            if tentar == 's':
                jogar(nome)
            else:
                print("Obrigado por jogar! AtÃ© a prÃ³xima!")
            break

print("OlÃ¡, jogador!")
print("--------------------")
time.sleep(1)

nome = input("Para iniciarmos o jogo, informe o seu nome: ")
print("--------------------")
print(f"Bem vindo ao COURT LABYRINTH, {nome}!")
print("--------------------")
time.sleep(2)

print("Para iniciarmos o jogo, vocÃª precisa apenas saber como funciona:")
print("--------------------")
time.sleep(1)
print('- Para andar para a DIREITA, use a tecla "D"')
time.sleep(1)
print('- Para andar para a ESQUERDA, use a tecla "A"')
time.sleep(1)
print('- Para andar para BAIXO, use a tecla "S"')
time.sleep(1)
print('- Para andar para CIMA, use a tecla "W"')
time.sleep(1)
print('- VocÃª precisa encontrar a CHAVE (â™–), abrir a PORTA (â–£), e entÃ£o chegar ao final (â™”)')
print("--------------------")
time.sleep(2)

entendeu = None
while entendeu != "s":
    entendeu = input("VocÃª entendeu as regras? [S/N]: ").lower()
    if entendeu == "s":
        print("Ã“timo! Vamos comeÃ§ar o jogo!")
        print("--------------------")
        time.sleep(1)
    else:
        print("Sem problemas! Vamos revisar as regras de novo.\n")
        time.sleep(1)
        print('- Para andar para a DIREITA, use a tecla "D"')
        time.sleep(1)
        print('- Para andar para a ESQUERDA, use a tecla "A"')
        time.sleep(1)
        print('- Para andar para BAIXO, use a tecla "S"')
        time.sleep(1)
        print('- Para andar para CIMA, use a tecla "W"')
        time.sleep(1)
        print('- VocÃª precisa encontrar a CHAVE (â™–), abrir a PORTA (â–£), e entÃ£o chegar ao final (â™”)')
        time.sleep(1)
        print("--------------------")

jogar(nome)
